{
  "title": "タッチデバイスのタップ動作・スワイプ動作を正確に検知する",
  "date": "2018-1-5",
  "description": "",
  "text": "<p>　スマホやタブレットなどのタッチデバイスを考慮せずに実装されたウェブアプリケーションは、タップ動作（画面をタッチして、タッチしたポイントを動かさずに、すぐに離す）に対する反応に遅延が発生することがある。この遅延はユーザー体験の低下に直接つながるため、タッチデバイスのタップに対する挙動は正確に実装すべきである。</p><p>　タッチデバイスのブラウザウィンドウ内でタッチ開始が検知されるとtouchstartイベントが、タッチされたポイントの移動が検知されるとtouchmoveイベントが、画面へのタッチ終了が検知されるとtouchstartイベントが発生する。このタッチイベントに対する処理をなにも登録していないウェブアプリケーションでタップをすると、そのタップはクリックイベントとして検知される。一般的に、ユーザーはクリックと同様の動作を期待してタップをするため、結果的には期待通りの処理が実行される。ただし、そのタップがダブルタップ（一般的に、ユーザーはズームを期待して行なう動作）の1回目のタップでないことをブラウザが判断するため、クリックイベントが発生するまでに待機時間が発生する。この待機時間こそが、タップに対する遅延の原因である。よって、タップをタッチイベントで正確に検知することができれば、この遅延は解消される。</p><p>　ここからは、タップで画面遷移をすることを想定した実装について記述していく。タップに対する遅延を解消するためにタッチイベントに画面遷移を登録するとしても、touchstartイベントに登録すればタッチした瞬間に画面遷移が発生してしまうし、touchendイベントに登録すればユーザーがスクロールを期待したスワイプが終了したタイミングで画面遷移が発生してしまう可能性がある。つまり、“タッチを開始したポイントから移動せずにタッチが終了した”タイミングで画面遷移をしなければ、タップによるユーザーの期待通りの画面遷移を実装することはできない。</p><p>　タッチイベントは複数ポイントのタッチに対応するため、一つのタッチの開始から終了までのtouchstartイベント、touchmoveイベント、touchendイベントを個別に検知する。よって、“タッチを開始したポイントから移動せずにタッチが終了した”という条件を満たすtouchendイベントに画面遷移を登録すれば、ユーザーの期待通りの挙動を実装できる。具体的には、touchstartイベントが発生するとタップであることを示すフラグを立て、touchmoveイベントが発生するとそのフラグを下ろし、そのフラグが立っている場合のtouchendイベントにのみ画面遷移を登録することで、タップを正確に検知する画面遷移を実装することが可能になる。</p><p>　上記のタッチイベントを利用すれば、スワイプに対する挙動のコントロールも可能になる。touchmoveイベントは、touchstartイベントが発生したポイントを（0, 0）としたX座標・Y座標でポイントの移動距離をピクセル単位で捕捉する。よって、右方向に30ピクセル以上スワイプされた、というような動作もtouchmoveイベントで検知することができる。タップを検知する場合、この移動距離がX座標・Y座標ともに0でない場合にフラグを下ろすことで、touchendイベントにタップであることを正確に伝えることができる。</p>"
}
